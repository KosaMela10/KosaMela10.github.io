<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kávé Adatbázis - Javított CSV Betöltő</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        body { background-color: #120b06; color: #f3ece4; font-family: sans-serif; }
        .glass { background: rgba(43, 29, 20, 0.9); border: 2px solid #d4a373; border-radius: 1rem; }
    </style>
</head>
<body class="p-4 md:p-10">

<div class="max-w-4xl mx-auto">
    <div id="errorBox" class="hidden bg-red-900 border-2 border-red-500 text-white p-4 rounded-xl mb-6">
        <h3 class="font-bold">Hiba történt az adatok betöltésekor!</h3>
        <p id="errorText" class="text-sm"></p>
    </div>

    <header class="flex justify-between items-center mb-8 border-b border-[#d4a373] pb-6">
        <h1 class="text-2xl font-black text-[#d4a373]">COFFEE DATA PRO</h1>
        <select id="countrySelect" class="bg-[#2a1d13] border border-[#d4a373] p-2 rounded text-white outline-none">
            <option>CSV fájl keresése...</option>
        </select>
    </header>

    <div class="glass p-8 shadow-2xl">
        <h2 id="title" class="text-3xl font-bold mb-6 text-center text-[#d4a373]">Válassz országot a listából!</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10 text-center">
            <div class="bg-[#1a120b] p-4 rounded-lg">
                <p class="text-xs text-gray-500 uppercase">Fogyasztás</p>
                <p id="fogyasztas" class="text-2xl font-bold">-</p>
            </div>
            <div class="bg-[#1a120b] p-4 rounded-lg">
                <p class="text-xs text-gray-500 uppercase">Piacméret</p>
                <p id="piac" class="text-2xl font-bold text-green-500">-</p>
            </div>
            <div class="bg-[#1a120b] p-4 rounded-lg">
                <p class="text-xs text-gray-500 uppercase">Kávézók</p>
                <p id="kavezo" class="text-2xl font-bold">-</p>
            </div>
        </div>

        <div style="height: 300px; position: relative;">
            <canvas id="mainChart"></canvas>
        </div>
    </div>
</div>

<script>
const csvUrl = 'data/kave_adatok.csv?nocache=' + new Date().getTime();
let chart;

Papa.parse(csvUrl, {
    download: true,
    header: true,
    dynamicTyping: true,
    skipEmptyLines: true,
    complete: function (results) {

        if (!results.data.length) {
            showError("A CSV fájl üres.");
            return;
        }

        const data = results.data;

        const select = document.getElementById("countrySelect");
        select.innerHTML = `<option disabled selected>Válassz országot...</option>`;

        data.forEach((row, index) => {
            if (row.Orszag) {
                const opt = document.createElement("option");
                opt.value = index;
                opt.textContent = row.Orszag;
                select.appendChild(opt);
            }
        });

        select.onchange = () => updateUI(data[select.value]);
    },
    error: () => showError("Nem sikerült betölteni a CSV fájlt.")
});

function showError(msg) {
    document.getElementById("errorBox").classList.remove("hidden");
    document.getElementById("errorText").innerText = msg;
}

function updateUI(d) {
    document.getElementById("title").innerText = d.Orszag;
    document.getElementById("fogyasztas").innerText = d.Fogyasztas_2024 + " kg/fő";
    document.getElementById("piac").innerText = d.Piac_Meret_Millio_EUR + " M €";
    document.getElementById("kavezo").innerText = d.Kavezo_Szam.toLocaleString();

    const ctx = document.getElementById("mainChart");
    if (chart) chart.destroy();

    chart = new Chart(ctx, {
        type: "bar",
        data: {
            labels: ["Egy főre jutó fogyasztás"],
            datasets: [{
                label: d.Orszag,
                data: [d.Fogyasztas_2024],
                backgroundColor: "#d4a373"
            }]
        },
        options: {
            maintainAspectRatio: false,
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
}
</script>

</body>
</html>

