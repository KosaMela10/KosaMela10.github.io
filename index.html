<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kávépiaci Dashboard - 3 Diagram</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        body { background-color: #120b06; color: #f3ece4; font-family: sans-serif; }
        .glass { background: rgba(43, 29, 20, 0.9); border: 1px solid #d4a373; border-radius: 1rem; }
        .chart-box { height: 250px; position: relative; }
    </style>
</head>
<body class="p-4 md:p-8">

<header class="max-w-6xl mx-auto mb-8 flex justify-between items-center border-b border-[#d4a373] pb-4">
    <h1 class="text-2xl font-black text-[#d4a373]">COFFEE ANALYTICS</h1>
    <select id="countrySelect" class="bg-[#2a1d13] border border-[#d4a373] p-2 rounded text-white outline-none">
        <option>Adatok betöltése...</option>
    </select>
</header>

<main class="max-w-6xl mx-auto">
    <h2 id="countryTitle" class="text-3xl font-bold mb-6 text-center text-white">Válassz országot a CSV-ből!</h2>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        
        <div class="glass p-5 shadow-xl text-center">
            <h3 class="text-[#d4a373] font-bold mb-4 uppercase text-sm">Fogyasztás (kg/fő)</h3>
            <div class="chart-box"><canvas id="chart1"></canvas></div>
            <p id="val1" class="mt-4 text-2xl font-black">-</p>
        </div>

        <div class="glass p-5 shadow-xl text-center">
            <h3 class="text-[#d4a373] font-bold mb-4 uppercase text-sm">Piacméret (Millió EUR)</h3>
            <div class="chart-box"><canvas id="chart2"></canvas></div>
            <p id="val2" class="mt-4 text-2xl font-black text-green-500">-</p>
        </div>

        <div class="glass p-5 shadow-xl text-center">
            <h3 class="text-[#d4a373] font-bold mb-4 uppercase text-sm">Kávézók száma</h3>
            <div class="chart-box"><canvas id="chart3"></canvas></div>
            <p id="val3" class="mt-4 text-2xl font-black">-</p>
        </div>

    </div>

    <div class="mt-8 glass p-4 text-center">
        <p class="text-gray-400 text-sm">Legnépszerűbb kávétípus az országban:</p>
        <span id="favType" class="text-xl font-bold italic text-[#d4a373]">-</span>
    </div>
</main>

<script>
    const csvUrl = 'data/kave_adatok.csv?v=' + Date.now();
    let charts = {};

    Papa.parse(csvUrl, {
        download: true,
        header: true,
        dynamicTyping: true,
        skipEmptyLines: true,
        complete: function(results) {
            const data = results.data;
            const select = document.getElementById('countrySelect');
            select.innerHTML = '<option value="" disabled selected>Válassz egyet (20+ ország)...</option>';

            data.forEach((row, i) => {
                if(row.Orszag) {
                    let opt = document.createElement('option');
                    opt.value = i; opt.text = row.Orszag; select.appendChild(opt);
                }
            });

            select.onchange = function() {
                updateDashboard(data[this.value]);
            };
        }
    });

    function createChart(id, label, value, color, max) {
        const ctx = document.getElementById(id).getContext('2d');
        if (charts[id]) charts[id].destroy();
        
        charts[id] = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: [label],
                datasets: [{
                    data: [value],
                    backgroundColor: color,
                    borderRadius: 10
                }]
            },
            options: {
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { 
                    y: { beginAtZero: true, max: max, ticks: { color: '#888' }, grid: { color: '#2c1e14' } },
                    x: { grid: { display: false }, ticks: { color: '#fff' } }
                }
            }
        });
    }

    function updateDashboard(d) {
        document.getElementById('countryTitle').innerText = d.Orszag;
        document.getElementById('favType').innerText = d.Kedvenc_Tipus;
        
        // Számértékek frissítése
        document.getElementById('val1').innerText = d.Fogyasztas_2024 + " kg";
        document.getElementById('val2').innerText = d.Piac_Meret_Millio_EUR + " M€";
        document.getElementById('val3').innerText = d.Kavezo_Szam.toLocaleString();

        // 3 Különböző diagram kirajzolása
        createChart('chart1', 'Kg/fő', d.Fogyasztas_2024, '#d4a373', 15);
        createChart('chart2', 'Millió EUR', d.Piac_Meret_Millio_EUR, '#4ade80', 5000);
        createChart('chart3', 'Egység', d.Kavezo_Szam, '#8d6e63', 160000);
    }
</script>
</body>
</html>
