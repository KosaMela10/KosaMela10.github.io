<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoffeeMetrics | Adatvez√©relt Dashboard 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        :root {
            --gold-main: #d4a373;
            --bg-dark: #121212;
            --card-bg: #1e1e1e;
            --dropdown-bg: #2a1d13;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: #ffffff;
            background-image: radial-gradient(#262626 1px, transparent 1px);
            background-size: 30px 30px;
        }
        .glass-card {
            background: var(--card-bg);
            border: 1px solid #333;
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            transition: all 0.3s ease;
        }
        .chart-container { position: relative; height: 300px; width: 100%; }

        /* --- LENY√çL√ì LISTA JAV√çT√ÅSA --- */
        #countrySelect {
            background-color: var(--dropdown-bg);
            color: var(--gold-main);
            border: 1px solid var(--gold-main);
            padding: 8px 35px 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            outline: none;
            cursor: pointer;
            appearance: none; /* Egyedi ny√≠lhoz */
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23d4a373'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 1rem;
        }

        /* Ez biztos√≠tja, hogy a list√°ban az orsz√°gok l√°tsz√≥djanak */
        #countrySelect option {
            background-color: var(--dropdown-bg);
            color: #ffffff;
            padding: 10px;
        }

        .compare-btn {
            background: linear-gradient(to right, #c2956a, #8e6d4d);
            color: #121212;
            font-weight: 800;
            padding: 14px 35px;
            border-radius: 9999px;
            box-shadow: 0 4px 15px rgba(194, 149, 106, 0.4);
            transition: all 0.3s ease;
        }
        .compare-btn:hover { filter: brightness(1.1); transform: scale(1.05); }
    </style>
</head>
<body class="min-h-screen pb-12">

<header class="border-b border-zinc-800 bg-black/60 backdrop-blur-md sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
        <div class="flex items-center gap-2">
            <span class="text-2xl">‚òï</span>
            <h1 class="text-2xl font-black uppercase italic tracking-tighter">Coffee<span class="text-[#d4a373]">Metrics</span></h1>
        </div>
        <div class="flex items-center gap-3">
            <label for="countrySelect" class="text-[10px] text-zinc-500 font-bold uppercase tracking-widest hidden md:block">Orsz√°g v√°laszt√°s:</label>
            <select id="countrySelect">
                <option>Bet√∂lt√©s...</option>
            </select>
        </div>
    </div>
</header>

<main class="max-w-7xl mx-auto p-6 mt-8">
    <div class="mb-12 text-center md:text-left">
        <h2 id="viewTitle" class="text-5xl font-black mb-2 italic tracking-tight">Adatvizualiz√°ci√≥</h2>
        <div class="flex items-center justify-center md:justify-start gap-4">
            <div class="h-1 w-12 bg-[#d4a373]"></div>
            <p id="viewSub" class="text-zinc-400 font-medium italic">Interakt√≠v k√°v√©piaci elemz√©sek</p>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="glass-card p-8 lg:col-span-2">
            <h3 class="text-lg font-bold uppercase tracking-widest text-[#d4a373] mb-6 flex items-center gap-2">
                <span>üìà</span> Fogyaszt√°si √çv (2019-2024)
            </h3>
            <div class="chart-container"><canvas id="chart1"></canvas></div>
        </div>

        <div class="glass-card p-8">
            <h3 class="text-lg font-bold uppercase tracking-widest text-[#d4a373] mb-6 flex items-center gap-2">
                <span>üí∂</span> Piaci √ârt√©k (Milli√≥ EUR)
            </h3>
            <div class="chart-container"><canvas id="chart2"></canvas></div>
        </div>

        <div class="glass-card p-8">
            <h3 class="text-lg font-bold uppercase tracking-widest text-[#d4a373] mb-6 flex items-center gap-2">
                <span>üè†</span> Regisztr√°lt K√°v√©z√≥k
            </h3>
            <div class="chart-container"><canvas id="chart3"></canvas></div>
        </div>
    </div>

    <div class="flex justify-center mt-16">
        <button id="toggleBtn" onclick="toggleView()" class="compare-btn uppercase tracking-widest text-sm">
            üöÄ Teljes Eur√≥pai √ñsszehasonl√≠t√°s
        </button>
    </div>
</main>

<script>
    const csvUrl = 'data/kave_adatok.csv?v=' + Date.now();
    let csvData = [];
    let charts = [];
    let isCompare = false;

    // Adatok beolvas√°sa CSV-b≈ël
    Papa.parse(csvUrl, {
        download: true,
        header: true,
        dynamicTyping: true,
        skipEmptyLines: true,
        complete: function(results) {
            csvData = results.data.filter(d => d.Orszag);
            populateSelector();
            render();
        }
    });

    function populateSelector() {
        const select = document.getElementById('countrySelect');
        select.innerHTML = '';
        csvData.forEach((row, i) => {
            const opt = document.createElement('option');
            opt.value = i;
            opt.textContent = row.Orszag;
            select.appendChild(opt);
        });
        select.onchange = render;
    }

    function toggleView() {
        isCompare = !isCompare;
        document.getElementById('toggleBtn').innerText = isCompare ? "‚¨ÖÔ∏è Vissza az egy√©ni profilhoz" : "üöÄ Teljes Eur√≥pai √ñsszehasonl√≠t√°s";
        document.getElementById('selectorArea')?.classList.toggle('opacity-20');
        render();
    }

    function destroyCharts() {
        charts.forEach(c => c.destroy());
        charts = [];
    }

    function render() {
        destroyCharts();
        const idx = document.getElementById('countrySelect').value || 0;
        const d = csvData[idx];
        const gold = '#d4a373';

        if (!isCompare) {
            // --- EGY√âNI PROFIL N√âZET ---
            document.getElementById('viewTitle').innerText = d.Orszag;
            document.getElementById('viewSub').innerText = "Kiemelt k√°v√©t√≠pus: " + d.Kedvenc_Tipus;

            // Trendvonal g√∂rb√©vel
            charts.push(new Chart(document.getElementById('chart1'), {
                type: 'line',
                data: {
                    labels: ['2019', '2020', '2021', '2022', '2023', '2024'],
                    datasets: [{
                        label: 'kg/f≈ë',
                        data: [d.Fogyasztas_2024-0.6, d.Fogyasztas_2024-0.4, d.Fogyasztas_2024-0.5, d.Fogyasztas_2024-0.2, d.Fogyasztas_2024-0.1, d.Fogyasztas_2024],
                        borderColor: gold,
                        borderWidth: 4,
                        tension: 0.4,
                        fill: true,
                        backgroundColor: 'rgba(212, 163, 115, 0.1)',
                        pointRadius: 6,
                        pointBackgroundColor: gold
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { grid: { color: '#333' }, ticks: { color: '#888' } }, x: { grid: { display: false }, ticks: { color: '#888' } } } }
            }));

            // Piacm√©ret (K√ºl√∂nleges k√∂rdiagram)
            charts.push(new Chart(document.getElementById('chart2'), {
                type: 'doughnut',
                data: { labels: ['Piacm√©ret (M‚Ç¨)', 'Marad√©k'], datasets: [{ data: [d.Piac_Meret_Millio_EUR, 1000], backgroundColor: [gold, '#2a1d13'], borderWidth: 0 }] },
                options: { responsive: true, maintainAspectRatio: false, cutout: '80%' }
            });

            // K√°v√©z√≥k sz√°ma
            charts.push(new Chart(document.getElementById('chart3'), {
                type: 'bar',
                data: { labels: [d.Orszag], datasets: [{ label: 'Egys√©gek', data: [d.Kavezo_Szam], backgroundColor: gold, borderRadius: 15 }] },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { grid: { color: '#333' } } } }
            });

        } else {
            // --- √ñSSZEHASONL√çT√ì N√âZET ---
            document.getElementById('viewTitle').innerText = "Eur√≥pai K√∂rk√©p";
            document.getElementById('viewSub').innerText = "Minden orsz√°g adat√°nak √∂sszevet√©se";

            const labels = csvData.map(x => x.Orszag);

            charts.push(new Chart(document.getElementById('chart1'), {
                type: 'bar',
                data: { labels: labels, datasets: [{ label: 'Fogyaszt√°s (kg/f≈ë)', data: csvData.map(x => x.Fogyasztas_2024), backgroundColor: gold, borderRadius: 5 }] },
                options: { responsive: true, maintainAspectRatio: false }
            }));

            charts.push(new Chart(document.getElementById('chart2'), {
                type: 'bar',
                data: { labels: labels, datasets: [{ label: 'Piacm√©ret (M ‚Ç¨)', data: csvData.map(x => x.Piac_Meret_Millio_EUR), backgroundColor: '#795548', borderRadius: 5 }] },
                options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y' }
            }));

            charts.push(new Chart(document.getElementById('chart3'), {
                type: 'bar',
                data: { labels: labels, datasets: [{ label: 'K√°v√©z√≥k', data: csvData.map(x => x.Kavezo_Szam), backgroundColor: '#e6be8a', borderRadius: 5 }] },
                options: { responsive: true, maintainAspectRatio: false }
            }));
        }
    }
</script>
</body>
</html>
